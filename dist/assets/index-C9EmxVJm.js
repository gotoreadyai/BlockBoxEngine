import{r as e,j as t,R as n}from"./react-CYM50T_J.js";import{c as a}from"./react-dom-CVSfZYju.js";import{c as o}from"./zustand-CKqDtEBy.js";import{E as r,S as i,A as s,V as l,a as c,D as d,C as u,L as h,b as p,c as m,d as x,T as f,M as g,e as v,f as b,g as w,P as y,h as S,i as j,j as T,k as N}from"./@babylonjs-DJaPBFT9.js";import{F as C,a as P}from"./react-icons-CDMk7YDv.js";import{d as B}from"./compress-json-BSyRvo9O.js";import"./scheduler-DhxmCZ7v.js";import"./use-sync-external-store-CrqN-JHg.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const k=o((()=>({route:"start",currentChunk:"chunk01",fps:"0",blocks:[[1,1,1],[0,1,1],[0,1,1],[0,1,1],[0,1,1],[0,1,1],[0,1,1]],selectedBlock:0,scenario:{}})));function A({handleReact:n}){const a=e.useCallback((e=>{"Tab"===e.key&&k.setState((()=>({route:"voxel-preview"===k.getState().route?"voxel-editor":"voxel-preview"}))),e.preventDefault()}),[]);return e.useEffect((()=>(document.addEventListener("keydown",a,!1),()=>{document.removeEventListener("keydown",a,!1)})),[a]),t.jsx("input",{type:"hidden"})}const L=({antialias:n,engineOptions:a,adaptToDeviceRatio:o,sceneOptions:s,onRender:l,onSceneReady:c,...d})=>{const u=e.useRef(null);return e.useEffect((()=>{const{current:e}=u;if(e)try{const t=new r(e,n=!0,a,o=!0),d=new i(t,s);t.onContextLostObservable,d.blockMaterialDirtyMechanism=!0,d.blockfreeActiveMeshesAndRenderingGroups=!0,d.getAnimationRatio(),d.isReady()?c(d):d.onReadyObservable.addOnce((e=>c(e))),t.runRenderLoop((()=>{"function"==typeof l&&l(d),k.setState((()=>({fps:t.getFps().toFixed()+" fps"}))),d.render()}));const u=()=>{d.getEngine().resize()};return window.addEventListener("resize",u),()=>{d.getEngine().dispose(),window.removeEventListener("resize",u)}}catch(t){}}),[n,a,o,s,l,c]),t.jsx("canvas",{className:"block w-full h-full outline-none",ref:u,...d})},M=e=>{const t=new s("mainArcRotateCamera",Math.PI/2,Math.PI/5,40,l.Zero(),e);return t.attachControl(e.getEngine().getRenderingCanvas(),!0),t.lowerBetaLimit=c.FromDegrees(0).radians(),t.upperBetaLimit=c.FromDegrees(90).radians(),t.useBouncingBehavior=!0,t},E=e=>{const t=new d("mainLight",new l(-1,-2,-1),e);t.position=new l(0,7,7),t.intensity=7,t.diffuse=new u(1,1,1),t.specular=new u(.4,.2,.5);const n=new h;return n.scaleRatio=1,n.light=t,t},O=e=>{const t=new d("hemiBackupLight",new l(1,0,0),e);t.intensity=.75,t.position=new l(-7,0,0);const n=new d("hemiBackupLight",new l(-1,0,0),e);n.intensity=.75,n.position=new l(7,0,0);const a=new d("hemiBackupLight",new l(1,0,2),e);return a.intensity=.25,a.position=new l(0,0,-7),t},R=e=>{const t=new p(256,e);return e.shadowMaxZ=128,e.shadowMinZ=0,t.normalBias=.65,t.setDarkness(.05),t.bias=.005,t.useContactHardeningShadow=!0,t.filteringQuality=p.QUALITY_LOW,t.useBlurExponentialShadowMap=!0,t.blurScale=1,t.blurBoxOffset=2,t};function I({index:e}){const n=[],a=k((e=>e.blocks)),o=k((e=>e.selectedBlock));for(let i=0;i<6;i++)n.push(t.jsx("div",{style:{imageRendering:"pixelated",backgroundImage:"url('/tiles.png')",backgroundSize:"142px",backgroundPosition:`-${24*i}px -${24*e}px`},className:"w-6 h-6 border border-gray-950"},i));return t.jsxs("div",{onClick:()=>k.setState({selectedBlock:e}),className:(o===e?"bg-zinc-700":"bg-zinc-800 hover:bg-lime-800 cursor-pointer")+" py-1.5 p-1.5 flex items-center gap-px ",children:[t.jsxs("span",{className:"flex-1",children:["BLOCK ",e]}),t.jsx("input",{onChange:t=>{const n=[...a];n[e]=t.target.value.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,a)=>"#"+t+t+n+n+a+a)).substring(1).match(/.{2}/g).map((e=>Math.round(parseInt(e,16)/255*10)/10)),k.setState({blocks:n})},className:"bg-gray-700 p-px appearance-none h-6 w-8",type:"color",name:"color",value:(r=a[e],"#"+r.map((e=>{const t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t})).join(""))}),n]});var r}const z=e=>{m.ShadersStore.customVertexShader="\n    precision highp float;\n    #extension GL_EXT_draw_buffers : require\n\n    attribute vec3 position;\n    attribute vec3 normal;\n    attribute vec2 uv;\n    attribute vec2 uv2;\n    attribute vec4 color2;\n\n    uniform mat4 viewProjection;\n    uniform mat4 worldViewProjection;\n    uniform mat4 lightViewProjection;\n    uniform vec3 lightPosition; \n    \n    varying vec3 vPositionW;\n    varying vec3 vNormalW;\n    varying vec2 vUV;\n    varying vec3 vLightVectorW; \n    varying vec4 bufferColor; \n\n    varying vec4 vShadowCoord; \n\n    #include<instancesDeclaration>\n    #include<helperFunctions>\n    #include<__decl__lightFragment>[0..1]\n    #include<shadowsFragmentFunctions>\n    \n    void main(void) {\n    #include<instancesVertex>\n    #include<shadowsVertex>[0]\n\n    vec4 worldPosition = finalWorld * vec4(position, 1.0);\n    vPositionW = vec3(worldPosition);\n    vLightVectorW = normalize(lightPosition - vPositionW);\n    vNormalW = normalize(mat3(finalWorld) * normal);\n    vShadowCoord = lightViewProjection * finalWorld * vec4(vPositionW, 0.01); \n    \n    vUV = uv + uv2;\n    bufferColor = color2;  // Pass color2 to fragment shader\n\n    gl_Position = viewProjection * worldPosition;\n    }\n  ",m.ShadersStore.customFragmentShader="\n  precision highp float;\n  uniform sampler2D textureSampler;\n  uniform sampler2D shadowSampler;\n  uniform float lightIntensity;\n  uniform float TT[4];\n  uniform float TBL[5];\n\n  varying vec2 vUV;\n  varying vec4 bufferColor;  // Receive color2 from vertex shader\n\n  varying vec3 vPositionW;\n  varying vec3 vNormalW;\n  varying vec3 vLightVectorW;\n  varying vec4 vShadowCoord;\n\n  float unpackDepth(const in vec4 rgbaDepth) {\n      const vec4 bitShift = vec4(0.75, 0.1 / 255.0, 0.1 / (255.0 * 255.0), 0.1 / (255.0 * 255.0 * 255.0));\n      float depth = dot(rgbaDepth, bitShift);\n      return depth;\n  }\n\n  void main() {\n      vec3 shadowCoord = vShadowCoord.xyz / vShadowCoord.w;\n      shadowCoord = vNormalW * vPositionW * shadowCoord *  0.5 + 0.25;\n    \n      float shadow = 0.75;\n      if (shadowCoord.z < 1.0) {\n          float shadowDepth = unpackDepth(texture2D(shadowSampler, shadowCoord.xy));\n          shadow = shadowDepth < shadowCoord.z ? 0.7 : 1.0;\n      }\n\n      // Light\n      float ndl = max(0.0, dot(vNormalW, vLightVectorW));\n      vec3 textureColor = texture2D(textureSampler, vUV).rgb;\n      \n      // Cartoon effect\n      if (ndl > TT[0]) { textureColor *= TBL[0]; }\n      else if (ndl > TT[1]) { textureColor *= TBL[1]; }\n      else if (ndl > TT[2]) { textureColor *= TBL[2]; }\n      else if (ndl > TT[3]) { textureColor *= TBL[3]; }\n      else { textureColor *= TBL[4]; }\n\n      vec3 burn = vec3(1,1,1);\n      if (textureColor.r < 0.6) {\n        burn *= vec3(bufferColor.g * 1.25, bufferColor.g * 1.25, bufferColor.b * 1.25);\n      } else{\n        burn = vec3(0.8,0.8,0.8);\n        shadow *= 1.25;\n      }\n      \n      // textureColor *= lightIntensity * shadow * vPositionW;\n      textureColor *= shadow *  0.9;  \n\n      float blurRadius = 0.01;\n      float texOffset = 0.5;\n      for (float x = -blurRadius; x <= blurRadius; x++) {\n          textureColor += texture2D(textureSampler, vUV + vec2(x, 0) * texOffset).rgb * vec3(0.25,0.25,0.25);\n      }\n      gl_FragColor = vec4( textureColor * burn , 1) * bufferColor; \n  }\n  ";const t=new x("custom",e,{vertex:"custom",fragment:"custom"},{attributes:["position","normal","uv","uv2","color2"],uniforms:["world","worldView","worldViewProjection","view","projection","viewProjection","lightIntensity","lightPosition","lightViewProjection","TT","TBL"],samplers:["textureSampler","shadowSampler"]}),n=q(),a=new f(`https://gotoreadyai.github.io/blockboxengine/scenarios/${n}/tiles.png`,e,!0,!1,f.NEAREST_SAMPLINGMODE);t.setTexture("textureSampler",a),t.setFloat("lightIntensity",.5);const o=new f("/minishadow.png",e,!0,!1,f.NEAREST_SAMPLINGMODE);t.setTexture("shadowSampler",o);const r=new d("dirLight",new l(-1,-1,-1),e);r.position=new l(20,40,20);const i=new p(0,r);e.meshes.forEach((e=>{(e=>{e instanceof g&&(e.receiveShadows=!0,i.addShadowCaster(e))})(e)})),t.setVector3("lightPosition",r.position),t.setMatrix("lightViewProjection",r.getShadowGenerator().getTransformMatrix());return e.onBeforeRenderObservable.add((()=>{const n=e.activeCamera;if(!n)return;e.meshes.forEach((e=>{const a=(o=e.position,l.Distance(o,n.position));var o;const r=1-Math.min(a/150,1),i=[.95,.5,.2,.1,.03].map((e=>e*r)),s=[1.5,1.2,1,.7,.5].map((e=>.6*e));t.setFloats("TT",i),t.setFloats("TBL",s)}))})),t},_=(e,t)=>new S(e/6,t/7,(e+1)/6,(t+1)/7),D=(e,t)=>new S((e+1)/6,(t+1)/7,e/6,t/7),F=(e,t,n,a)=>{const o=v.CreateBox("chunkHelper",{size:15},a);o.material=new b("material"),o.material.alpha=0,o.showBoundingBox=!0,o.receiveShadows=!1,o.isPickable=!1,o.position.x=15*e[0],o.position.y=15*e[1],o.position.z=15*e[2];const r=v.CreatePlane("plane",{size:1},a);r.position.y=1,r.billboardMode=2;const i=new b("material",a),s=new f("/bilboard.png",a,!0,!1,f.NEAREST_SAMPLINGMODE);i.ambientTexture=s,i.opacityTexture=s,s.hasAlpha=!0,r.material=i;const l=v.CreateBox("mesh",{size:1,faceUV:[D(0,0),D(1,0),D(2,0),D(3,0),_(4,0),_(5,0)],wrap:!0},a);return l.previousWorldMatrixInstancedBuffer,l.material=z(a),l.receiveShadows=!0,l.thinInstanceEnablePicking=!0,l.parent=o,V(t,l),n.addShadowCaster(l),{voxelMesh:l,chunkHelper:o}},V=(e,t)=>{const n=new Float32Array(16*e.length),a=new Float32Array(2*e.length),o=new Float32Array(4*e.length);return e.forEach(((e,t)=>{w.Translation(1*e[0],1*e[1],1*e[2]).copyToArray(n,16*t),a.set([0,e[3]/7],2*t),o.set([e[4],e[5],e[6],1],4*t)})),t.thinInstanceSetBuffer("matrix",n),t.thinInstanceSetBuffer("uv2",a,2),t.thinInstanceSetBuffer("color2",o,4),t},W=(e,t,n,a)=>{const o=e=>e[0]>=-7&&e[0]<=7&&e[1]>=-7&&e[1]<=7&&e[2]>=-7&&e[2]<=7;e.onPointerObservable.add((r=>{if(r.type===y.POINTERDOWN){var i=e.pick(e.pointerX,e.pointerY,(e=>e===n));if((null==i?void 0:i.hit)&&void 0!==i.thinInstanceIndex){const e=i.thinInstanceIndex,l=[t[e][0],t[e][1],t[e][2]],c=i.getNormal(!0);if(c&&"voxel-editor"===k.getState().route){const a=k.getState().blocks,i=k.getState().selectedBlock;if(0===r.event.button){const e=[l[0]+Math.round(c.x),l[1]+Math.round(c.y),l[2]+Math.round(c.z)];if(o(e)){let o=1;((e,t,n,a,o)=>{a.push([...e,t,...n]),V(a,o),localStorage.setItem("0_chunk_0_0_0",JSON.stringify(a))})(e,i,[...a[i],o],t,n),s=e,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]].map((([e,t,n])=>[s[0]+e,s[1]+t,s[2]+n]))}}else 2===r.event.button&&o(l)&&((e,t,n)=>{t.splice(e,1),V(t,n),localStorage.setItem("0_chunk_0_0_0",JSON.stringify(t))})(e,t,n)}c&&"voxel-preview"===k.getState().route&&(a.position.x=l[0],a.position.y=l[1],a.position.z=l[2])}}var s}))},K=[{id:"center",label:"center",min:-.5,max:.5,step:.01,parentBone:"root",rotationAxis:j.X,default:0},{id:"belly",label:"belly",min:-.5,max:.5,step:.01,parentBone:"center",rotationAxis:j.Y,default:0},{id:"chest",label:"chest",min:-.5,max:.5,step:.01,parentBone:"belly",rotationAxis:j.Z,default:0},{id:"neckBottom",label:"neckBottom",min:-.5,max:.5,step:.01,parentBone:"chest",rotationAxis:j.Z,default:0},{id:"neckTop",label:"neckTop",min:-.5,max:.5,step:.01,parentBone:"neckBottom",rotationAxis:j.X,default:0},{id:"head",label:"head",min:-.5,max:.5,step:.01,parentBone:"neckTop",rotationAxis:j.Y,default:0},{id:"rightShoulder1",label:"rightShoulder1",min:-.9,max:.9,step:.01,parentBone:"rightShoulderPin1",rotationAxis:j.Z,default:0},{id:"rightShoulder2",label:"rightShoulder2",min:-.9,max:.9,step:.01,parentBone:"rightShoulderPin2",rotationAxis:j.Y,default:0},{id:"rightShoulder3",label:"rightShoulde3",min:-.5,max:.5,step:.01,parentBone:"rightShoulderPin3",rotationAxis:j.Z,default:0},{id:"rightShoulder4",label:"rightShoulde4",min:-.5,max:.5,step:.01,parentBone:"rightArm",rotationAxis:j.Z,default:0},{id:"rightHipPin",label:"rightHipPin",min:-.5,max:.5,step:.01,parentBone:"rightHipPin",rotationAxis:j.Z,default:0},{id:"rightHip",label:"rightHip",min:-.5,max:.5,step:.01,parentBone:"rightHip",rotationAxis:j.X,default:0},{id:"rightLeg",label:"rightLeg",min:-.5,max:.5,step:.01,parentBone:"rightLeg",rotationAxis:j.X,default:0},{id:"leftShoulder1",label:"leftShoulder1",min:-.9,max:.9,step:.01,parentBone:"leftShoulderPin1",rotationAxis:j.Z,default:0},{id:"leftShoulder2",label:"leftShoulder2",min:-.9,max:.9,step:.01,parentBone:"leftShoulderPin2",rotationAxis:j.Y,default:0},{id:"leftShoulder3",label:"leftShoulde3",min:-.5,max:.5,step:.01,parentBone:"leftShoulderPin3",rotationAxis:j.Z,default:0},{id:"leftShoulder4",label:"leftShoulde4",min:-.5,max:.5,step:.01,parentBone:"leftArm",rotationAxis:j.Z,default:0}];w.Translation(0,0,0),w.Translation(0,.4,0),w.Translation(0,0,0),w.Translation(0,.2,0),w.Translation(0,.2,0),w.Translation(0,0,.355),w.Translation(0,.1,0),w.Translation(.35,.1,0),w.Translation(0,0,0),w.Translation(0,0,0),w.Translation(.3,.1,0),w.Translation(.15,0,0),w.Translation(0,0,0),w.Translation(-.35,.1,0),w.Translation(0,0,0),w.Translation(0,0,0),w.Translation(-.3,.1,0),w.Translation(-.15,0,0),w.Translation(0,0,0),w.Translation(0,0,0),w.Translation(0,0,0),w.Translation(0,-.2,0),w.Translation(0,0,0),w.Translation(0,0,0),w.Translation(0,0,0),w.Translation(0,-.2,0),w.Translation(0,0,0);const H=(e,t,n)=>{const a=K.find((e=>e.id===t));a&&n.bones[a.parentBone].setAxisAngle(a.rotationAxis,Math.sin(e)*Math.PI)},U=({handleState:n})=>{const[a,o]=e.useState(K);return t.jsx("div",{className:"flex flex-col gap-3 mt-2 px-3 text-xs",children:K.map(((e,o)=>t.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[t.jsx("span",{className:"uppercase",children:e.label}),t.jsx("input",{className:"appearance-none h-4 rounded bg-gray-800",min:a[o].min,max:a[o].max,step:a[o].step,defaultValue:a[o].default,type:"range",onChange:e=>{const t=a;t[o].default=e.target.value,n({type:"bones",data:t,index:o})}})]},o)))})},Z=({keyframes:n,currentFrame:a,setCurrentFrame:o,addKeyframe:r})=>{const i=e.useRef(null);e.useEffect((()=>{if(i.current){const e=11*a-i.current.clientWidth/2;i.current.scrollTo({left:e,behavior:"smooth"})}}),[a]);const s=e=>{if(e===a)return"bg-blue-500";return n.some((t=>t.frame===e))?"bg-red-500":e%2==0?"bg-gray-300":"bg-gray-400"};return t.jsxs("div",{className:"flex-1",children:[t.jsx("button",{className:"bg-blue-700 text-white text-xs px-3 py-1.5 rounded",onClick:r,children:"Add Keyframe"}),t.jsx("div",{className:"relative w-full h-8 bg-gray-800 overflow-x-hidden",onClick:e=>{const t=e.currentTarget.getBoundingClientRect(),n=e.clientX-t.left,a=Math.floor(n/11);o(a)},ref:i,children:t.jsx("div",{className:" w-full h-full flex",children:Array.from({length:100},((e,n)=>t.jsx("div",{className:`${s(n)}`,style:{width:"10px",marginRight:"1px"},onClick:()=>o(n),children:n%10==0&&t.jsx("span",{className:"text-xs absolute bottom-0",children:n})},n)))})}),t.jsxs("div",{children:["Current Frame:",t.jsx("input",{type:"number",className:"border ml-2 p-1",value:a,onChange:e=>o(Number(e.target.value))})]})]})},$=({initialKeyframes:n})=>{const[a,o]=e.useState(n),[r,i]=e.useState(0);return t.jsx("div",{className:"flex-1 flex",children:t.jsx(Z,{keyframes:a,currentFrame:r,setCurrentFrame:i,addKeyframe:()=>{const e=[...a,{frame:r,value:{x:0,y:0,z:0}}];o(e)}})})};function X({children:e,handleReact:n}){var a,o,r,i,s,l,c,d;const u=k((e=>e.route)),h=k((e=>e.fps)),p=k((e=>e.blocks)),m=k((e=>e.scenario));return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"flex flex-col w-screen h-screen fixed select-none bg-zinc-700 font-pixel",children:[t.jsxs("div",{className:"flex gap-px p-px text-gray-200 text-base bg-zinc-800",children:[t.jsx("div",{className:"py-1.5 px-3 w-80  font-black ",children:"BLOCK BOX V0.0.1"}),t.jsxs("div",{className:"flex items-center",children:["MENU ",t.jsx(C,{})," SCENE ",t.jsx(C,{})," PREVIEW"]}),t.jsx("div",{className:"flex-1"})]}),t.jsxs("div",{className:"flex flex-1 text-base mt-px",children:[m&&(null==(o=null==(a=m.views)?void 0:a[u])?void 0:o.popup)&&t.jsx("div",{className:"select-none fixed top-0 w-screen h-[calc(100vh-3rem)] flex flex-col items-center justify-center text-gray-200 gap-px text-xl",children:(null==(s=null==(i=null==(r=m.views)?void 0:r[u])?void 0:i.popup)?void 0:s.menu)&&(x=null==(d=null==(c=null==(l=m.views)?void 0:l[u])?void 0:c.popup)?void 0:d.menu,x.map((e=>t.jsx("div",{className:"bg-zinc-800 hover:bg-zinc-950 p-4 w-72 cursor-pointer",onClick:()=>k.setState((()=>({route:e.route}))),children:e.label}))))}),t.jsxs("div",{className:"w-80 flex flex-col text-gray-200 gap-px text-sm",children:["voxel-preview"===u&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-zinc-800 py-1.5 px-3",children:"CHUNK 0_0_-1"}),t.jsx("div",{className:"bg-zinc-800 py-1.5 px-3",children:"CHUNK 0_0_1"}),t.jsx("div",{className:"bg-zinc-800 py-1.5 px-3",children:"CHUNK 0_0_2"}),t.jsx("div",{className:"flex-1 bg-zinc-800"})]}),"voxel-editor"===u&&t.jsx(t.Fragment,{})]}),t.jsx("div",{className:"flex-1  bg-zinc-400 ",children:e}),t.jsxs("div",{className:"w-80 flex flex-col text-gray-200 gap-px ",children:["voxel-preview"===u&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-slate-700 hover:bg-lime-600 hover:text-gray-950 px-4 gap-2 py-1 border-b-2 border-slate-600 flex items-center cursor-pointer",children:[t.jsx(P,{})," ",t.jsx("span",{children:"OPEN EDITOR [TAB]"})]}),t.jsx(U,{handleState:n})]}),"voxel-editor"===u&&t.jsxs(t.Fragment,{children:[p.map(((e,n)=>t.jsx(I,{index:n},n))),t.jsx("div",{className:"bg-zinc-800 flex-1"})]})]})]}),t.jsxs("div",{className:"flex gap-px p-px text-gray-200 text-base bg-zinc-800 mt-px",children:[t.jsx("div",{className:" py-1.5 px-3 w-80",children:h}),t.jsx($,{initialKeyframes:[{frame:0,value:{x:0,y:1,z:0}},{frame:20,value:{x:1,y:1,z:0}},{frame:40,value:{x:0,y:1,z:1}}]})]})]})});var x}const G=e=>{const t=new T("sps",e,{enableDepthSort:!0}),n=v.CreateBox("m",{},e);t.addShape(n,250);const a=new b("m",e);a.alpha=.25,a.disableLighting=!0,a.emissiveColor=new u(1,1,1),n.dispose(),t.buildMesh();t.mesh.material=a;t.updateParticle=t=>{t.originalPosition||(t.position.x=200*(Math.random()-.5),t.position.y=24,t.position.z=200*(Math.random()-.5),t.scaling.x=24*Math.random(),t.scaling.y=1,t.scaling.z=24*Math.random(),t.color.r=1,t.color.g=1,t.color.b=1,t.originalPosition=t.position.clone());const n=e.getEngine().getDeltaTime();return t.position.x+=.1*n/1e3,t},t.setParticles(),t.depthSortParticles=!1,e.registerBeforeRender((()=>{t.setParticles()}))},Y=e=>{const t=v.CreateBox("targeter",{size:1.1},e),n=new b("material",e),a=new f("/selector.png",e,!0,!1,f.NEAREST_SAMPLINGMODE);return n.ambientTexture=a,n.opacityTexture=a,t.material=n,t.position.x=0,t.position.y=0,t};function J(){let e,n,a,o,r,i=JSON.parse(localStorage.getItem("0_chunk_0_0_0")||"[\n      [0, 0, 0, 0, 1, 1, 1, 0, 0],\n      [1, 0, 0, 1, 1, 1, 1, 0, 0]\n    ]");const s=e=>{"bones"===e.type&&H(e.data[e.index].default,e.data[e.index].id,undefined)};return t.jsxs(t.Fragment,{children:[t.jsxs(X,{handleReact:s,children:[" ",t.jsx(L,{antialias:!0,onSceneReady:async t=>{a=M(t),n=E(t),O(t),e=R(n),o=Y(t);const{voxelMesh:s,chunkHelper:l}=F([0,0,0],i,e,t);r=l,W(t,i,s,o),G(t),t.autoClearDepthAndStencil=!1,t.blockMaterialDirtyMechanism=!0,t.blockfreeActiveMeshesAndRenderingGroups=!0;let c=new N("animAlpha","alpha",60,N.ANIMATIONTYPE_FLOAT,N.ANIMATIONLOOPMODE_CONSTANT),d=[];d.push({frame:0,value:a.alpha}),d.push({frame:50,value:3.14}),c.setKeys(d);let u=new N("animBeta","beta",60,N.ANIMATIONTYPE_FLOAT,N.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:a.beta}),h.push({frame:200,value:3.14}),u.setKeys(h),a.animations=[],a.animations.push(c),a.animations.push(u),t.beginAnimation(a,0,200,!1)},engineOptions:{preserveDrawingBuffer:!0},adaptToDeviceRatio:!0})]}),t.jsx(A,{handleReact:s})]})}const q=()=>{let e=window.location;return new URL(e.href).searchParams.get("project")};function Q(){const[n,a]=e.useState(null),[o,r]=e.useState([]),i=q();return e.useEffect((()=>{(async()=>{if(i){const e=await async function(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Response status: ${t.status}`);return await t.json()}catch(t){}}(`https://gotoreadyai.github.io/blockboxengine/projects/${i}.json`);k.setState({scenario:e}),a(e),e&&e.chunks&&await Promise.all(e.chunks.map((async e=>{const t=await async function(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Response status: ${t.status}`);return await t.text()}catch(t){}}(`https://gotoreadyai.github.io/blockboxengine/scenarios/${i}/chunks/${e}.txt`),n=(e=>B.decompress(JSON.parse(window.atob(e))))(t);window.localStorage.setItem(e,JSON.stringify(n)),r(t)})))}})()}),[i]),i&&o?t.jsx(J,{}):t.jsx(t.Fragment,{children:t.jsx("a",{href:"https://gotoreadyai.github.io/blockboxengine/?project=editor",children:"BLOCKBOX: Project is required"})})}a.createRoot(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(Q,{})}));
